window.ReadiumLibraryData=[{fixed_layout:!1,open_to_spread:!1,cover_href:"/images/library/missing-cover-image.png",created_at:"2012-03-27T19:22:01.521Z",updated_at:"2012-03-27T19:23:38.309Z",key:"1",src_url:"Local Directory: linear-algebra/",package_doc_path:"/epub_content/1/EPUB/package.opf",id:"code.google.com.epub-samples.linear-algebra",epub_version:"3.0",title:"A First Course in Linear Algebra",author:"Robert A. Beezer",publisher:"",description:"",rights:"This work is shared with the public using the GNU Free Documentation License, Version 1.2.",
language:"en",pubdate:"",modified_date:"2012-03-05T12:47:00Z",layout:"",spread:"",orientation:"",ncx:""},{fixed_layout:!1,open_to_spread:!1,cover_href:"/epub_content/2/EPUB/images/portrait.jpg",created_at:"2012-03-27T19:24:45.543Z",updated_at:"2012-03-27T19:25:00.094Z",key:"2",src_url:"Local Directory: cole-voyage-of-life/",package_doc_path:"/epub_content/2/EPUB/cole.opf",id:"code.google.com.epub-samples.cole-voyage-of-life",epub_version:"3.0",title:"Thomas Cole - The Voyage of Life",author:"Jesse Dylan",
publisher:"",description:"",rights:"This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.",language:"en-US",pubdate:"",modified_date:"2012-03-20T11:37:00Z",layout:"",spread:"",orientation:"",ncx:""},{fixed_layout:!1,open_to_spread:!1,cover_href:"/epub_content/3/EPUB/wasteland-cover.jpg",created_at:"2012-03-27T19:25:40.235Z",updated_at:"2012-03-27T19:26:06.326Z",key:"3",src_url:"Local Directory: wasteland/",package_doc_path:"/epub_content/3/EPUB/wasteland.opf",
id:"code.google.com.epub-samples.wasteland-basic",epub_version:"3.0",title:"The Waste Land",author:"T.S. Eliot",publisher:"",description:"",rights:"This work is shared with the public using the Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0) license.",language:"en-US",pubdate:"2011-09-01",modified_date:"2012-01-18T12:47:00Z",layout:"",spread:"",orientation:"",ncx:"ncx"},{fixed_layout:!0,open_to_spread:!1,cover_href:"/epub_content/4/OPS/Image/cover.jpg",created_at:"2012-03-28T18:24:18.450Z",updated_at:"2012-03-28T18:25:32.553Z",
key:"4",src_url:"Local Directory: page-blanche/",package_doc_path:"/epub_content/4/OPS/package.opf",id:"urn:uuid:d5803940-647f-11e1-ad77-0002a5d5c51b",epub_version:"3.0",title:"Page Blanche",author:"Boulet",publisher:"\u00e9ditions Delcourt",description:"",rights:"This work is shared with the public using the Attribution-ShareAlike 3.0 Unported (CC BY-SA 3.0) license.",language:"fr",pubdate:"2012-01-18",modified_date:"2012-03-06T12:00:00Z",layout:"pre-paginated",spread:"auto",orientation:"auto",ncx:""},
{author:"Mary Webb",cover_href:"/images/library/missing-cover-image.png",created_at:"2012-04-10T21:47:53.353Z",description:"",epub_version:"2.0",fixed_layout:!1,id:"urn:uuid:ADDB2B4D-BA43-4DE9-8BAB-CF8759C8F843",key:"3921047c34132ab12338059f09bbf5c8",language:"en-gb",layout:"",modified_date:"",ncx:"ncx",open_to_spread:!1,orientation:"",package_doc_path:"/epub_content/5/OPS/content.opf",pubdate:"2002",publisher:"epubBooks (www.epubbooks.com)",rights:"\u21b5            Provided for free by epubBooks.com. Not for commercial use.\u21b5            This EPUB eBook is released under a Creative Commons (BY-NC-ND/3.0) Licence.\u21b5            Source text and images are in the Public Domain.\u21b5      ",
spread:"",src_url:"webb-precious-bane.epub",title:"Precious Bane",updated_at:"2012-04-10T21:48:57.267Z"}];
if(!window.Readium)window.Readium={Models:{},Collections:{},Views:{},Routers:{},Utils:{},Init:function(){window.options=Readium.Models.ReadiumOptions.getInstance();window.optionsView=new Readium.Views.ReadiumOptionsView({model:window.options});window.Library=new Readium.Collections.LibraryItems(window.ReadiumLibraryData);window.lib_view=new Readium.Views.LibraryItemsView({collection:window.Library});window.router=new Readium.Routers.ApplicationRouter({collection:window.Library});Backbone.history.start({pushState:!1});
window.Library.trigger("reset");$("#block-view-btn").click(function(){$("#library-items-container").addClass("block-view").removeClass("row-view")});$("#row-view-btn").click(function(){$("#library-items-container").addClass("row-view").removeClass("block-view")})}};$(function(){window.Readium.Init()});
Readium.HttpFileApi=function(){var b={readTextFile:function(a,c,b){$.ajax({url:a,dataType:"text",success:function(a,b,d){c(a,d)},error:function(a,c,d){b(a,c,d)}})},getFsUri:function(a,b){b(document.location.protocol+"//"+document.location.host+a)}};return function(a){a(b);return b}}();Readium.FileSystemApi=Readium.HttpFileApi;
Readium.Utils.Guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0;return(d=="x"?b:b&3|8).toString(16)})};
Readium.Utils.LocalStorageAdaptor=function(d){var b,f=function(){localStorage.setItem(d,JSON.stringify(b))};return function(h,a,e){var c,g=localStorage.getItem(d);b=g&&JSON.parse(g)||{};switch(h){case "read":c=a.id?b[a.id]:_.values(b);break;case "create":if(!a.id)a.id=a.attributes.id=guid();b[a.id]=a;f();c=a;break;case "update":b[a.id]=a;f();c=a;break;case "delete":delete b[a.id],f(),c=a}c?e.success&&e.success(c):e.error&&e.error("Record not found")}};
Readium.Utils.setCookie=function(d,a,b){var c=new Date;c.setDate(c.getDate()+b);a=escape(a)+(b==null?"":"; expires="+c.toUTCString());document.cookie=d+"="+a};Readium.Utils.getCookie=function(d){var a,b,c,e=document.cookie.split(";");for(a=0;a<e.length;a++)if(b=e[a].substr(0,e[a].indexOf("=")),c=e[a].substr(e[a].indexOf("=")+1),b=b.replace(/^\s+|\s+$/g,""),b==d)return unescape(c)};Readium.Utils.trimString=function(d){return d.replace(/^\s+|\s+$/g,"")};
Readium.Models.ReadiumOptions=Backbone.Model.extend({initialize:function(){this.set("id","singleton")},defaults:{hijack_epub_urls:!1,verbose_unpacking:!0,paginate_everything:!0},sync:Readium.Utils.LocalStorageAdaptor("READIUM_OPTIONS")},{getInstance:function(){var a=new Readium.Models.ReadiumOptions;a.fetch({error:function(){localStorage.setItem("READIUM_OPTIONS","");a.save()}});return a}});
Readium.Models.LibraryItem=Backbone.Model.extend({idAttribute:"key",getViewBookUrl:function(){return"/viewer.html?book="+this.get("key")},openInReader:function(){window.location=this.getViewBookUrl()}});Readium.Collections.LibraryItems=Backbone.Collection.extend({model:Readium.Models.LibraryItem,url:"/epub_content/metadata.json"});
Readium.Views.LibraryItemView=Backbone.View.extend({tagName:"div",className:"book-item clearfix",initialize:function(){_.bindAll(this,"render");this.template=_.template($("#library-item-template").html())},render:function(){var a=this.template({data:this.model.toJSON()});$(this.el).html(a);return this},events:{"click .delete":function(a){a.preventDefault();var b="#details-modal-"+this.model.get("key"),a="Are you sure you want to perminantly delete ";a+=this.model.get("title");a+="?";confirm(a)&&($(b).modal("hide"),
this.model.destroy(),this.remove())},"click .read":function(){this.model.openInReader()}}});
Readium.Views.LibraryItemsView=Backbone.View.extend({tagName:"div",id:"library-items-container",className:"row-view clearfix",initialize:function(){this.template=_.template($("#library-items-template").html());this.collection.bind("reset",this.render,this);this.collection.bind("add",this.addOne,this)},render:function(){var a=this.collection,b=$(this.el);b.html(this.template({}));this.$("#empty-message").toggle(this.collection.isEmpty());a.each(function(c){c=new Readium.Views.LibraryItemView({model:c,
collection:a,id:c.get("id")});b.append(c.render().el)});$("#library-books-list").html(this.el);return this},addOne:function(a){a=new LibraryItemView({model:a,collection:this.collection,id:a.get("id")});this.$("#empty-message").toggle(!1);$(this.el).append(a.render().el)},events:{}});
Readium.Views.ExtractItemView=Backbone.View.extend({el:$("#progress-container")[0],initialize:function(){this.template=_.template($("#extracting-item-template").html());this.model.bind("change",this.render,this);this.model.bind("change:error",this.extractionFailed,this)},render:function(){var a=$(this.el);this.model.get("extracting")?(a.html(this.template(this.model.toJSON())),a.show("slow")):a.hide("slow");return this},extractionFailed:function(){alert(this.model.get("error"));this.model.set("extracting",
!1)}});
Readium.Views.ReadiumOptionsView=Backbone.View.extend({el:"#readium-options-modal",initialize:function(){this.model.on("change",this.render,this);this.render()},render:function(){var a=this.model;this.$("#paginate_everything").prop("checked",a.get("paginate_everything"));this.$("#verbose_unpacking").prop("checked",a.get("verbose_unpacking"));this.$("#hijack_epub_urls").prop("checked",a.get("hijack_epub_urls"))},events:{"change #verbose_unpacking":"updateSettings","change #hijack_epub_urls":"updateSettings","change #paginate_everything":"updateSettings",
"click #save-settings-btn":"save"},updateSettings:function(){var a=this.$("#hijack_epub_urls").prop("checked"),b=this.$("#verbose_unpacking").prop("checked"),c=this.$("#paginate_everything").prop("checked");this.model.set({verbose_unpacking:b,hijack_epub_urls:a,paginate_everything:c})},save:function(){this.model.save();this.$el.modal("hide")}});
Readium.Routers.ApplicationRouter=Backbone.Router.extend({initialize:function(a){this.collection=a.collection},routes:{"view_book/:id":"openBook","":"showLibrary"},openBook:function(a){this.showViewer();a=this.collection.get(a).toJSON();a.fixed_layout?(console.log("initializing fixed layout book"),window._book=new Readium.Models.AppleFixedEbook(a)):(console.log("initializing reflowable book"),window._book=new Readium.Models.ReflowableEbook(a));window._libraryView=new Readium.Views.ViewerApplicationView({model:window._book});
window._libraryView.render()},showLibrary:function(){$("#readium-library-activity").toggle(!0);$("#readium-viewer-activity").toggle(!1)},showViewer:function(){$("#readium-library-activity").toggle(!1);$("#readium-viewer-activity").toggle(!0)},splat_handler:function(a){console.log(a)}});
