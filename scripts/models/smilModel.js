Readium.Models.SmilModel=function(){function f(a){k(a);a.childNodes.length>0&&$.each(a.childNodes,function(a,b){f(b)})}function k(a){a.toString=function(){for(var a="<"+this.nodeName,b=0;b<this.attributes.length;b++)a+=" "+this.attributes.item(b).nodeName+"="+this.attributes.item(b).nodeValue;a+=">";return a};if(e.hasOwnProperty(a.tagName))a.render=e[a.tagName];if(g.hasOwnProperty(a.tagName))a.notifyChildDone=g[a.tagName];l(a)}function l(a){a.tagName=="audio"&&($(a).attr("src")!=void 0&&$(a).attr("src",
m($(a).attr("src"),h)),$(a).attr("clipBegin")!=void 0?$(a).attr("clipBegin",i($(a).attr("clipBegin"))):$(a).attr("clipBegin",0),$(a).attr("clipEnd")!=void 0?$(a).attr("clipEnd",i($(a).attr("clipEnd"))):$(a).attr("clipEnd",9999999))}function m(a,c){if(a.indexOf("://")!=-1)return a;var b=c;c[c.length-1]!="/"&&(b=c.substr(0,c.lastIndexOf("/")+1));return b+a}function i(a){var c=0,b=0,d=0;arr=a.split(":");d=parseFloat(arr.pop());arr.length>0?(b=parseFloat(arr.pop()),arr.length>0&&(c=parseFloat(arr.pop()))):
a.indexOf("min")!=-1?b=parseFloat(a.substr(0,a.indexOf("min"))):a.indexOf("ms")!=-1?d=parseFloat(a.substr(0,a.indexOf("ms")))/1E3:a.indexOf("s")!=-1?d=parseFloat(a.substr(0,a.indexOf("s"))):a.indexOf("h")!=-1&&(c=parseFloat(a.substr(0,a.indexOf("h"))));return c*3600+b*60+d}NodeLogic={parRender:function(){$.each(this.childNodes,function(a,c){c.hasOwnProperty("render")&&c.render()})},seqRender:function(a){a==null?this.firstElementChild.render():a.render()},audioNotifyChildDone:function(){this.parentNode.notifyChildDone(this)},
parNotifyChildDone:function(a){a.tagName=="audio"&&this.parentNode.notifyChildDone(this)},seqNotifyChildDone:function(a){a.nextElementSibling==null?this==d?j():this.parentNode.notifyChildDone(this):this.render(a.nextElementSibling)}};var e={seq:NodeLogic.seqRender,par:NodeLogic.parRender,body:NodeLogic.seqRender},g={seq:NodeLogic.seqNotifyChildDone,par:NodeLogic.parNotifyChildDone,body:NodeLogic.seqNotifyChildDone,audio:NodeLogic.audioNotifyChildDone,text:function(){}},h=null,j=null,d=null;this.addRenderers=
function(a){e=$.extend(e,a)};this.setUrl=function(a){h=a};this.setNotifySmilDone=function(a){j=a};this.build=function(a){d=a;f(a)};this.render=function(a){a==null||a==void 0||a==d?d.render(null):(this.peekNextAudio(a).isJumpTarget=!0,a.parentNode.render(a))};this.findNodeByAttrValue=function(a,c,b){if(d==null)return null;a=$(d).find(a+"["+c+"='"+b+"']");return a.length==0?null:a[0]};this.peekNextAudio=function(a){if(a.tagName=="par")return $(a).find("audio")[0];if(a.tagName=="text")return $(a.parentNode).find("audio")[0];
for(a=a.parentNode;a.nextElementSibling==null;)if(a=a.parentNode,a==d)return null;return $(a.nextElementSibling).find("audio")[0]}};
