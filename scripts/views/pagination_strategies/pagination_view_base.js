Readium.Views.PaginationViewBase=Backbone.View.extend({el:"#readium-book-view-el",initialize:function(){this.model.on("change:current_page",this.changePage,this);this.model.on("change:font_size",this.setFontSize,this);this.model.on("change:hash_fragment",this.goToHashFragment,this);this.bindingTemplate=_.template($("#binding-template").html())},destruct:function(){console.log("Pagination base destructor called");this.model.off("change:current_page",this.changePage);this.model.off("change:font_size",
this.setFontSize);this.model.off("change:hash_fragment",this.goToHashFragment);this.resetEl()},linkClickHandler:function(a){a.preventDefault();a=a.srcElement.attributes.href.value;a.match(/^http(s)?:/)?chrome.tabs.create({url:a}):this.model.goToHref(a)},goToHashFragment:function(){},getBindings:function(){var a=this.model.packageDocument;return a.get("bindings").map(function(b){b.selector='object[type="'+b.media_type+'"]';b.url=a.getManifestItemById(b.handler).get("href");b.url=a.resolveUri(b.url);
return b})},applyBindings:function(a){for(var b=this,c=this.getBindings(),d=0,d=0;d<c.length;d++)$(c[d].selector,a).each(function(){var a=[],e=$(this),f=e.attr("data");a.push("src="+b.model.packageDocument.resolveUri(f));a.push("type="+c[d].media_type);a=c[d].url+"?"+a.join("&");f=$(b.bindingTemplate({}));f.attr("src",a);e.html(f)})},applyTriggers:function(a,b){for(var c=0;c<b.length;c++)b[c].subscribe(a)},parseTriggers:function(a){var b=[];$("trigger",a).each(function(){b.push(new Readium.Models.Trigger(this))});
return b},applySwitches:function(a){$("switch",a).each(function(){var a=!1;$("case",this).each(function(){var c;if(c=!a)(c=this.attributes["required-namespace"])?c=_.include(["http://www.w3.org/1998/Math/MathML"],c):(console.log("Encountered a case statement with no required-namespace"),c=!1);c?a=!0:$(this).remove()});a&&$("default",this).remove()})},addStyleSheets:function(a){var b,c,d=!0;b=$(".readium-dynamic-sh");c=$("link[rel*='stylesheet']",a);b.length===c.length?b.each(function(a){var e=$(b[a]).attr("href"),
a=$(c[a]).attr("href");e!==a&&(d=!1)}):d=!1;d||($(".readium-dynamic-sh").remove(),$(c.get().reverse()).each(function(){var a=$(this);a.addClass("readium-dynamic-sh");$("head").prepend(a)}))},addSwipeHandlers:function(a){var b=this;$(a).on("swipeleft",function(a){a.preventDefault();b.model.goRight()});$(a).on("swiperight",function(a){a.preventDefault();b.model.goLeft()})},setUpMode:function(){var a=this.model.get("two_up");this.$el.toggleClass("two-up",a);this.$("#spine-divider").toggle(a)},events:{"click #page-margin":function(){this.trigger("toggle_ui")},
"click #readium-content-container a":function(a){this.linkClickHandler(a)}},isPageVisible:function(a,b){return b.indexOf(a)!==-1},changePage:function(){var a=this,b=this.model.get("current_page"),c=this.model.get("two_up");this.$(".page-wrap").each(function(d){c||(d+=1);$(this).toggleClass("hidden-page",!a.isPageVisible(d,b))})},replaceContent:function(a){this.$("#readium-content-container").css("visibility","hidden").html(a).append("<div id='content-end'></div>")},toggleTwoUp:function(){},setFontSize:function(){var a=
this.model.get("font_size")/10;$("#readium-content-container").css("font-size",a+"em");this.renderPages()},injectMathJax:function(a){var a=a.contentDocument,b=a.createElement("script");b.type="text/javascript";b.src=MathJax.Hub.config.root+"/MathJax.js?config=readium-iframe";a.getElementsByTagName("head")[0].appendChild(b)},injectLinkHandler:function(a){var b=this;$("a",a.contentDocument).click(function(a){b.linkClickHandler(a)})},resetEl:function(){$("body").removeClass("apple-fixed-layout");$("#readium-book-view-el").attr("style",
"");this.$el.toggleClass("two-up",!1);this.$("#spine-divider").toggle(!1);this.replaceContent("");$("#page-wrap").css({position:"relative",right:"0px",top:"0px","-webkit-transform":"scale(1.0) translate(0px, 0px)"})},iframeLoadCallback:function(a){this.applyBindings($(a.srcElement).contents());this.applySwitches($(a.srcElement).contents());this.addSwipeHandlers($(a.srcElement).contents());this.injectMathJax(a.srcElement);this.injectLinkHandler(a.srcElement);var b=this.parseTriggers(a.srcElement.contentDocument);
this.applyTriggers(a.srcElement.contentDocument,b)}});
